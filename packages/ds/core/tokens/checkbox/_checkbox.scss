@use '../../util/color' as color;
@use '../../util/theme' as theme;
@use '../../util/device' as device;
@use '../../util/size' as size;
@use '../template-const' as template-const;
@use '../sizes' as token-size;

@mixin selector {
    [type='checkbox'] {
        @content;
    }
}

@mixin checkbox($palette, $focus, $critical) {
    @at-root {
        #{template-const.$root-selectors} {
            @include theme.light {
                @include selector {
                    @include device.if-hover {
                        --text-hover: #{color.mix-token($palette, 800)};
                    }
                }
            }

            @include theme.dark {
                @include selector {
                    @include device.if-hover {
                        --text-hover: #{color.mix-token($palette, 500)};
                    }
                }
            }
        }
    }
}

@mixin create {
    @at-root {
        #{template-const.$root-selectors} {
            @include selector() {
                @include layout();
            }
        }
    }
}

@mixin layout {
    border-radius: token-size.$border-radius;
    appearance: none;
    outline: 0;
    box-sizing: border-box;
    background-color: var(--surface1);
    border: 1px solid var(--form-border);

    @include checkbox-size();
    @include checked();
    @include mixed-state();

    @include device.if-hover {
        color: var(--formcontrol-hover);
    }

    &::before {
        content: '';
        display: block;
    }

    &:disabled {
        background: var(--border-disabled);
        
        & + label {
            color: var(--text-disabled);
        }
    }
}

@mixin checked {
    &:checked  {
        background: var(--formcontrol);

        // draw the checkmark
        &::before { 
            text-align: center;
            display: inline-block;
            left: calc(50% - 8px / 2);
            top: calc(50% - 16px / 2);
            width: token-size.$relative-0-5;
            height: token-size.$relative-1;
            margin: 0 6px;
            border: solid var(--surface1);
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }

        &:required {
            background: var(--formcontrol-error);
        }

        &:disabled {
            background: var(--formcontrol-disabled);
        }
    }
}

@mixin mixed-state {
    &:required, &:invalid {
        --border: var(--formcontrol-error);
        
        background: var(--formcontrol-critical-background);

        &:disabled {
            background: var(--critical-border-disabled); 
        };
    }
}

@mixin checkbox-size {
    @include size.selector(small) {
        width: token-size.$relative-1-25;
        height: token-size.$relative-1-25;

        @extend .body3;
    }

    @include size.selector(large) {
        width: token-size.$relative-1-5;
        height: token-size.$relative-1-5;

        @extend .body2;
    }
}