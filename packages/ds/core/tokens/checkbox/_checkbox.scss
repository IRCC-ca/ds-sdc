@use '../../util/color' as color;
@use '../../util/theme' as theme;
@use '../../util/device' as device;
@use '../../util/size' as size;
@use '../template-const' as template-const;
@use '../sizes' as token-size;

@mixin selector {
    [type='checkbox'] {
        @content;
    }
}

@mixin checkbox($valid, $invalid) {
    @at-root {
        #{template-const.$root-selectors} {
            @include theme.light {
                @include selector {
                    @include theme.tokens-for-map(
                        (
                            --formcontrol-disabled: color.mix-token($valid, 300), 
                            --formcontrol: color.mix-token($valid, 700), 
                            --formcontrol-hover: color.mix-token($valid, 800),
                            --formcontrol-critical-background: color.mix-token($invalid, 100), 
                            --formcontrol-critical-hover: color.mix-token($invalid, 200),
                            --critical-background-weak-active: color.mix-token($invalid, 300),
                            --formcontrol-error: color.mix-token($invalid, 700),
                            --formcontrol-critical-border: color.mix-token($invalid, 800),
                            --critical-active: color.mix-token($invalid, 900)
                        )
                    )
                }
            }

            @include theme.dark {
                @include selector {
                    @include theme.tokens-for-map(
                        (
                            --formcontrol: color.mix-token($valid, 600),
                            --formcontrol-disabled: color.mix-token($valid, 1000), 
                            --formcontrol-hover: color.mix-token($valid, 900),
                            --formcontrol-critical-background: color.mix-token($invalid, 1200), 
                            --formcontrol-critical-hover: color.mix-token($invalid, 1100),
                            --critical-background-weak-active: color.mix-token($invalid, 1000),
                            --formcontrol-error: color.mix-token($invalid, 600),
                            --formcontrol-critical-border: color.mix-token($invalid, 500),
                            --critical-active: color.mix-token($invalid, 400)
                        )
                    );
                }
            }
        }
    }
}

@mixin create {
    @at-root {
        #{template-const.$root-selectors} {
            @include selector() {
                @include layout();
            }
        }
    }
}

@mixin layout {
    border-radius: token-size.$border-radius;
    appearance: none;
    margin: token-size.$form-control-margin;
    outline: 0;
    box-sizing: border-box;
    box-shadow: token-size.$border-style;
    vertical-align: top;

    // --background-color: var(--surface1);
    // --border: var(--border);

    @include checkbox-size();

    @include device.if-hover {
        color: var(--formcontrol-hover);
    }

    &:enabled {
        &:active {
            --background-color: var(--generic-active);
        }
    }

    &:disabled {
        --background: var(--border-disabled);
        
        & + label {
            color: var(--text-disabled);
        }
    }

    @include checked();
    @include invalid();
    @include mixed-state();
}

@mixin checked {
    &:checked  {
        --border: var(--formcontrol); 
        background: var(--formcontrol);

        // draw the checkmark
        &:before { 
            content: "\f00c";
            color: var(--surface1);
            position: absolute;
            width: token-size.$relative-0-5;
            height: token-size.$relative-1;
            // left: calc(50% - token-size.$relative-0-5/2);
            // top: calc(50% - token-size.$relative-1/2);

            @extend .fa-regular;
        }

        &:enabled {
            @include device.if-hover {
                --border: var(--formcontrol-hover);
            }

            &:active {
                --border: var(--formcontrol-hover);
            }
        }
    }
}

@mixin invalid {
    &:invalid{
        --formcontrol: var(--formcontrol-error);
        --background: var(--formcontrol-critical-background);
    
        &:enabled {
            @include device.if-hover {
                --border: var(--formcontrol-critical-border);
                --background: var(--formcontrol-critical-hover);
            }
    
            &:active {
                --border: var(--formcontrol-critical-border);
                --background: var(--critical-background-weak-active);
             }
        }
    }
}

@mixin mixed-state {
    &:indeterminate{
        background: var(--formcontrol);
        &:before 
        {
            content: "\f068";
            color: var(--surface1);
            position: absolute;
            width: 14px;
            height: 16px;
            // left: calc(50% - 14px/2);
            // top: calc(50% - 16px/2); 

            align-items: center;
            text-align: center;

            @extend .fa-regular;
        }
    }
}

@mixin checkbox-size {
    @include size.selector(small) {
        width: token-size.$relative-1-25;
        height: token-size.$relative-1-25;

        @extend .body3;
    }

    @include size.selector(large) {
        width: token-size.$relative-1-5;
        height: token-size.$relative-1-5;

        @extend .body2;
    }
}